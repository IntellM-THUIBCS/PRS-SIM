# Introduction of the Python code for PRS-SIM training

***

## 1. Environment
The Python Code for PRS-SIM is developed with Pytorch framework. To train the model and perform the denoising, GPU is required. We recommend to run the code in an Anaconda virtual environment to avoid the package and version conflict. To create an enviroment, please run the following in the cmd window or terminal:

``` Create the enviroment 
conda create -n PRS-SIM python=3.7
```

To install the Python framework and CUDA toolkit, please follow the instruction on the Pytorch website https://pytorch.org/get-started/locally/#windows-anaconda based on the exact type and version the hardware of your computer. An example command for Pytorch is (may be replaced by your own configuration)
``` Install pytorch-cuda
conda install pytorch torchvision torchaudio pytorch-cuda=11.7 -c pytorch -c nvidia
```

To install other packages, just run the following command:
``` Install packages
pip install -r requirements.txt
```


## 2. Data

PRS-SIM employed the super-resolution realigned SIM images to train the denoised, which is generated by apply pixel-realignment operation (can be implemented with our Matlab code) and conventional SIM reconstruction to the raw SIM image group. 

The default folder to save SIM data is './SIM_data/smpl_name', in which each sub-folder is organized as:

>├─ cellX  
>│    ├─ view1.tif  
>│    ├─ view2.tif  
>│    ├─ view3.tif  
>│    └─ view4.tif  
>...

****

## 3. Training

The example code to train the denoising model with PRS-SIM is:

``` for 2D-SIM
python Main_train_3D.py --gpu_id 0 --smpl_dir ./SIM_data --smpl_name Microtubules --net_type unet --save_suffix _0 --test_patch_size 128 --test_z_size 8 --max_iter 100000 --preload_data_flag
```

``` for 3D-SIM
python Main_train.py --gpu_id 0 --smpl_dir ./SIM_data --smpl_name Microtubules --net_type unet --save_suffix _0 --test_patch_size 128 --max_iter 100000 --preload_data_flag
```

****

## 4. Denoising

The example code to denoise the noisy image with a pre-trained PRS-SIM model is:

``` for 2D-SIM
python Main_test.py --gpu_id 0 --smpl_dir ./SIM_data --smpl_name Microtubules_test --net_type unet --model_name 100000_G --test_patch_size 1024 --model_z_size 8 --model_patch_size 128 --overlap_ratio 0.2
```

``` for 3D-SIM
python Main_test_3D.py --gpu_id 0 --smpl_dir ./SIM_data --smpl_name Lyso_test --net_type unet --model_name 100000_G --test_patch_size 1004 --model_patch_size 128 --overlap_ratio 0.2
```

****

The detailed tutorial of PRS-SIM is available on our website https://intellm-thuibcs.github.io/PRS-SIM .

Due to the storage limitation of Github, the example SR-SIM after the pixel realignment  Microtubules (TIRF-SIM) and Lysosome (3D-SIM) are uploaded on Google drive https://drive.google.com/drive/folders/1nYSQ5K94SqkoG65_N3Tn2zPL4dt0T0yX?usp=sharing .
